<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì‹œê°„ ì•„í¬ ê°ì§€ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.0/dist/chartjs-plugin-annotation.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00d4ff;
            --secondary: #7b2cbf;
            --success: #00ff88;
            --warning: #ffaa00;
            --danger: #ff4444;
            --dark: #1a1a2e;
            --darker: #0f0f1a;
            --card-bg: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 50%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }
        
        .bg-animation::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background: radial-gradient(circle at 20% 80%, rgba(0, 212, 255, 0.05) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(123, 44, 191, 0.05) 0%, transparent 50%);
            animation: bgMove 20s linear infinite;
        }
        
        @keyframes bgMove {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* í—¤ë” */
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: var(--card-bg);
            border-radius: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--primary));
            background-size: 200% 100%;
            animation: gradientMove 3s linear infinite;
        }
        
        @keyframes gradientMove {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }
        
        header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-flex;
            align-items: center;
            gap: 15px;
        }
        
        header h1 .icon {
            font-size: 2.5rem;
            -webkit-text-fill-color: initial;
        }
        
        header p {
            color: #888;
            font-size: 1rem;
        }
        
        /* ê²½ê³  ë°°ë„ˆ */
        .alert-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 15px;
            background: linear-gradient(135deg, var(--danger), #cc0000);
            text-align: center;
            font-weight: 700;
            font-size: 1.2rem;
            z-index: 1000;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
            box-shadow: 0 5px 30px rgba(255, 68, 68, 0.5);
        }
        
        .alert-banner.show {
            transform: translateY(0);
        }
        
        .alert-banner .pulse-icon {
            display: inline-block;
            animation: alertPulse 0.5s ease infinite;
        }
        
        @keyframes alertPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        /* ëŒ€ì‹œë³´ë“œ ê·¸ë¦¬ë“œ */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        
        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(0, 212, 255, 0.3);
        }
        
        .card h3 {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 500;
        }
        
        /* ê·¸ë¦¬ë“œ ë°°ì¹˜ */
        .col-3 { grid-column: span 3; }
        .col-4 { grid-column: span 4; }
        .col-6 { grid-column: span 6; }
        .col-8 { grid-column: span 8; }
        .col-12 { grid-column: span 12; }
        
        /* ìƒíƒœ ì¹´ë“œ */
        .status-card {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .status-dot-container {
            position: relative;
            width: 80px;
            height: 80px;
        }
        
        .status-dot {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            position: relative;
            z-index: 1;
        }
        
        .status-dot.normal {
            background: radial-gradient(circle, var(--success) 0%, rgba(0, 255, 136, 0.3) 70%);
            box-shadow: 0 0 40px rgba(0, 255, 136, 0.5);
        }
        
        .status-dot.arc {
            background: radial-gradient(circle, var(--danger) 0%, rgba(255, 68, 68, 0.3) 70%);
            box-shadow: 0 0 40px rgba(255, 68, 68, 0.5);
            animation: arcPulse 0.5s ease infinite;
        }
        
        .status-dot.stopped {
            background: radial-gradient(circle, #666 0%, rgba(102, 102, 102, 0.3) 70%);
        }
        
        @keyframes arcPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 40px rgba(255, 68, 68, 0.5); }
            50% { transform: scale(1.1); box-shadow: 0 0 60px rgba(255, 68, 68, 0.8); }
        }
        
        .status-ring {
            position: absolute;
            top: -10px;
            left: -10px;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 2px solid transparent;
        }
        
        .status-ring.active {
            border-color: var(--success);
            animation: ringPulse 2s ease infinite;
        }
        
        .status-ring.arc {
            border-color: var(--danger);
            animation: ringPulse 0.5s ease infinite;
        }
        
        @keyframes ringPulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        .status-info h2 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .status-info h2.normal { color: var(--success); }
        .status-info h2.arc { color: var(--danger); }
        .status-info h2.stopped { color: #888; }
        
        .status-info p {
            color: #888;
            font-size: 0.9rem;
        }
        
        /* ì»¨íŠ¸ë¡¤ ë²„íŠ¼ */
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-start {
            background: linear-gradient(135deg, var(--primary), #0099cc);
            color: #fff;
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.3);
        }
        
        .btn-start:hover {
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.5);
        }
        
        .btn-stop {
            background: linear-gradient(135deg, var(--danger), #cc0000);
            color: #fff;
            box-shadow: 0 5px 20px rgba(255, 68, 68, 0.3);
        }
        
        .btn-stop:hover {
            box-shadow: 0 10px 30px rgba(255, 68, 68, 0.5);
        }
        
        /* ëª¨ë“œ ë²„íŠ¼ */
        .mode-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }
        
        .mode-section h4 {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .mode-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .btn-mode {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            color: #aaa;
            border: 1px solid var(--border);
            font-size: 0.85rem;
        }
        
        .btn-mode:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        
        .btn-mode.active {
            background: linear-gradient(135deg, var(--secondary), #5a189a);
            border-color: var(--secondary);
            color: #fff;
            box-shadow: 0 5px 20px rgba(123, 44, 191, 0.3);
        }
        
        /* í™•ë¥  ê²Œì´ì§€ */
        .probability-card {
            text-align: center;
        }
        
        .gauge-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
        }
        
        .gauge-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                rgba(255, 255, 255, 0.1) 0deg,
                rgba(255, 255, 255, 0.1) 360deg
            );
        }
        
        .gauge-fill {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                var(--success) 0deg,
                var(--success) 0deg,
                transparent 0deg
            );
            transition: background 0.3s ease;
        }
        
        .gauge-center {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            bottom: 15px;
            background: var(--darker);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .probability-value {
            font-size: 3rem;
            font-weight: 700;
            line-height: 1;
        }
        
        .probability-value.low { color: var(--success); }
        .probability-value.medium { color: var(--warning); }
        .probability-value.high { color: var(--danger); }
        
        .probability-label {
            font-size: 0.9rem;
            color: #888;
            margin-top: 5px;
        }
        
        .probability-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 15px;
        }
        
        .probability-fill {
            height: 100%;
            transition: width 0.3s, background 0.3s;
            border-radius: 4px;
        }
        
        .timestamp {
            font-size: 0.85rem;
            color: #666;
            margin-top: 15px;
        }
        
        /* í†µê³„ ì¹´ë“œ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 20px 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(0, 212, 255, 0.3);
        }
        
        .stat-icon {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-value.danger { color: var(--danger); }
        .stat-value.warning { color: var(--warning); }
        
        .stat-label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* ì°¨íŠ¸ ì¹´ë“œ */
        .chart-card h3 {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-card h3 .live-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            background: rgba(255, 68, 68, 0.2);
            border-radius: 20px;
            font-size: 0.7rem;
            color: var(--danger);
            text-transform: uppercase;
        }
        
        .chart-card h3 .live-badge::before {
            content: '';
            width: 6px;
            height: 6px;
            background: var(--danger);
            border-radius: 50%;
            animation: livePulse 1s ease infinite;
        }
        
        @keyframes livePulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .chart-container {
            position: relative;
            height: 280px;
            margin-top: 15px;
        }
        
        /* ì„¼ì„œ ì •ë³´ ì¹´ë“œ */
        .sensor-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .sensor-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
        }
        
        .sensor-item .value {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
        }
        
        .sensor-item .label {
            font-size: 0.75rem;
            color: #888;
            margin-top: 5px;
        }
        
        /* ë°˜ì‘í˜• */
        @media (max-width: 1200px) {
            .col-3 { grid-column: span 6; }
            .col-4 { grid-column: span 6; }
            .col-8 { grid-column: span 12; }
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            header h1 { font-size: 1.5rem; }
            .col-3, .col-4, .col-6 { grid-column: span 12; }
            .dashboard { gap: 15px; }
            .gauge-container { width: 150px; height: 150px; }
            .probability-value { font-size: 2.5rem; }
        }
        
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--darker);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    
    <div class="alert-banner" id="alertBanner">
        <span class="pulse-icon">âš ï¸</span> ì•„í¬ ê°ì§€! ì¦‰ì‹œ ì ê²€ì´ í•„ìš”í•©ë‹ˆë‹¤!
    </div>
    
    <div class="container">
        <header>
            <h1><span class="icon">âš¡</span> ì‹¤ì‹œê°„ ì•„í¬ ê°ì§€ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ</h1>
            <p>ìŠ¤ë§ˆíŠ¸ ì „ë¥˜ ì„¼ì„œ ê¸°ë°˜ AI ì•„í¬ íŒŒí˜• ë¶„ì„ | ì´ˆë‹¹ 35íšŒ ìƒ˜í”Œë§ | 1ì´ˆ ë‹¨ìœ„ ì‹¤ì‹œê°„ ì˜ˆì¸¡</p>
        </header>
        
        <div class="dashboard">
            <!-- ìƒíƒœ ì¹´ë“œ -->
            <div class="card col-4 status-card">
                <h3>ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ</h3>
                <div class="status-indicator">
                    <div class="status-dot-container">
                        <div class="status-ring" id="statusRing"></div>
                        <div class="status-dot stopped" id="statusDot">â¸ï¸</div>
                    </div>
                    <div class="status-info">
                        <h2 class="stopped" id="statusText">ëŒ€ê¸° ì¤‘</h2>
                        <p id="modeText">ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</p>
                    </div>
                </div>
                <div class="controls">
                    <button class="btn-start" onclick="startMonitoring()">
                        <span>â–¶</span> ì‹œì‘
                    </button>
                    <button class="btn-stop" onclick="stopMonitoring()">
                        <span>â¹</span> ì¤‘ì§€
                    </button>
                </div>
                <div class="mode-section">
                    <h4>ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ</h4>
                    <div class="mode-buttons">
                        <button class="btn-mode" onclick="setMode('normal', this)">ì •ìƒ</button>
                        <button class="btn-mode" onclick="setMode('arc_spike', this)">ìŠ¤íŒŒì´í¬</button>
                        <button class="btn-mode" onclick="setMode('arc_continuous', this)">ì—°ì†ì•„í¬</button>
                        <button class="btn-mode" onclick="setMode('arc_intermittent', this)">ê°„í—ì•„í¬</button>
                        <button class="btn-mode active" onclick="setMode('random', this)">ëœë¤</button>
                    </div>
                </div>
            </div>
            
            <!-- ì•„í¬ í™•ë¥  ê²Œì´ì§€ -->
            <div class="card col-4 probability-card">
                <h3>ğŸ¯ ì•„í¬ ë°œìƒ í™•ë¥ </h3>
                <div class="gauge-container">
                    <div class="gauge-bg"></div>
                    <div class="gauge-fill" id="gaugeFill"></div>
                    <div class="gauge-center">
                        <div class="probability-value low" id="probabilityValue">0%</div>
                        <div class="probability-label">ì•„í¬ í™•ë¥ </div>
                    </div>
                </div>
                <div class="probability-bar">
                    <div class="probability-fill" id="probabilityFill" style="width: 0%; background: var(--success);"></div>
                </div>
                <div class="timestamp" id="timestamp">-</div>
            </div>
            
            <!-- í†µê³„ ì¹´ë“œ -->
            <div class="card col-4">
                <h3>ğŸ“ˆ ì‹¤ì‹œê°„ í†µê³„</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon">ğŸ”</div>
                        <div class="stat-value" id="totalWindows">0</div>
                        <div class="stat-label">ë¶„ì„ íšŸìˆ˜</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">âš¡</div>
                        <div class="stat-value danger" id="arcCount">0</div>
                        <div class="stat-label">ì•„í¬ ê°ì§€</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">ğŸ“Š</div>
                        <div class="stat-value warning" id="arcRatio">0%</div>
                        <div class="stat-label">ì•„í¬ ë¹„ìœ¨</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">ğŸ“‰</div>
                        <div class="stat-value" id="avgProb">0%</div>
                        <div class="stat-label">í‰ê·  í™•ë¥ </div>
                    </div>
                </div>
            </div>
            
            <!-- ì‹¤ì‹œê°„ íŒŒí˜• ì°¨íŠ¸ -->
            <div class="card col-8 chart-card">
                <h3>
                    ğŸŒŠ ì‹¤ì‹œê°„ ì „ë¥˜ íŒŒí˜• (1ì´ˆ ìœˆë„ìš°)
                    <span class="live-badge">LIVE</span>
                </h3>
                <div class="chart-container">
                    <canvas id="waveformChart"></canvas>
                </div>
            </div>
            
            <!-- ì„¼ì„œ ì •ë³´ -->
            <div class="card col-4">
                <h3>ğŸ”§ ì„¼ì„œ ì •ë³´</h3>
                <div class="sensor-info">
                    <div class="sensor-item">
                        <div class="value">35</div>
                        <div class="label">ìƒ˜í”Œë§ (Hz)</div>
                    </div>
                    <div class="sensor-item">
                        <div class="value">1ì´ˆ</div>
                        <div class="label">ìœˆë„ìš° í¬ê¸°</div>
                    </div>
                    <div class="sensor-item">
                        <div class="value">60Hz</div>
                        <div class="label">ê¸°ë³¸ ì£¼íŒŒìˆ˜</div>
                    </div>
                </div>
                <div class="sensor-info" style="margin-top: 15px;">
                    <div class="sensor-item">
                        <div class="value" id="rmsValue">-</div>
                        <div class="label">RMS (A)</div>
                    </div>
                    <div class="sensor-item">
                        <div class="value" id="peakValue">-</div>
                        <div class="label">Peak (A)</div>
                    </div>
                    <div class="sensor-item">
                        <div class="value" id="thdValue">-</div>
                        <div class="label">THD (%)</div>
                    </div>
                </div>
            </div>
            
            <!-- í™•ë¥  íˆìŠ¤í† ë¦¬ ì°¨íŠ¸ -->
            <div class="card col-12 chart-card">
                <h3>
                    ğŸ“ˆ ì•„í¬ í™•ë¥  íˆìŠ¤í† ë¦¬ (ìµœê·¼ 60ì´ˆ)
                    <span class="live-badge">LIVE</span>
                </h3>
                <div class="chart-container">
                    <canvas id="historyChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ì°¨íŠ¸ ì„¤ì •
        Chart.defaults.color = '#888';
        Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';
        
        // íŒŒí˜• ì°¨íŠ¸
        const waveformCtx = document.getElementById('waveformChart').getContext('2d');
        const waveformChart = new Chart(waveformCtx, {
            type: 'line',
            data: {
                labels: Array.from({length: 35}, (_, i) => i),
                datasets: [{
                    label: 'ì „ë¥˜ (A)',
                    data: Array(35).fill(0),
                    borderColor: '#00d4ff',
                    backgroundColor: 'rgba(0, 212, 255, 0.1)',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: { duration: 0 },
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                scales: {
                    x: {
                        title: { display: true, text: 'ìƒ˜í”Œ', color: '#888' },
                        grid: { color: 'rgba(255, 255, 255, 0.05)' }
                    },
                    y: {
                        title: { display: true, text: 'ì „ë¥˜ (A)', color: '#888' },
                        grid: { color: 'rgba(255, 255, 255, 0.05)' }
                    }
                },
                plugins: {
                    legend: { display: false }
                }
            }
        });
        
        // íˆìŠ¤í† ë¦¬ ì°¨íŠ¸
        const historyCtx = document.getElementById('historyChart').getContext('2d');
        const historyChart = new Chart(historyCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'ì•„í¬ í™•ë¥  (%)',
                    data: [],
                    borderColor: '#ff4444',
                    backgroundColor: (context) => {
                        const chart = context.chart;
                        const {ctx, chartArea} = chart;
                        if (!chartArea) return null;
                        const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
                        gradient.addColorStop(0, 'rgba(255, 68, 68, 0)');
                        gradient.addColorStop(0.5, 'rgba(255, 68, 68, 0.1)');
                        gradient.addColorStop(1, 'rgba(255, 68, 68, 0.3)');
                        return gradient;
                    },
                    fill: true,
                    tension: 0.3,
                    pointRadius: 3,
                    pointBackgroundColor: '#ff4444',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: { duration: 0 },
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                scales: {
                    x: {
                        title: { display: true, text: 'ì‹œê°„', color: '#888' },
                        grid: { color: 'rgba(255, 255, 255, 0.05)' },
                        ticks: { maxRotation: 45, maxTicksLimit: 15 }
                    },
                    y: {
                        min: 0,
                        max: 100,
                        title: { display: true, text: 'í™•ë¥  (%)', color: '#888' },
                        grid: { color: 'rgba(255, 255, 255, 0.05)' }
                    }
                },
                plugins: {
                    legend: { display: false },
                    annotation: {
                        annotations: {
                            threshold: {
                                type: 'line',
                                yMin: 50,
                                yMax: 50,
                                borderColor: '#ffaa00',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                label: {
                                    display: true,
                                    content: 'ì„ê³„ê°’ 50%',
                                    position: 'end',
                                    backgroundColor: 'rgba(255, 170, 0, 0.8)',
                                    color: '#000',
                                    font: { size: 10 }
                                }
                            }
                        }
                    }
                }
            }
        });
        
        let currentMode = 'random';
        let isRunning = false;
        
        // API í•¨ìˆ˜ë“¤
        async function startMonitoring() {
            try {
                const response = await fetch('/api/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mode: currentMode })
                });
                const data = await response.json();
                if (data.status === 'started') {
                    isRunning = true;
                }
            } catch (error) {
                console.error('ì‹œì‘ ì˜¤ë¥˜:', error);
            }
        }
        
        async function stopMonitoring() {
            try {
                const response = await fetch('/api/stop', { method: 'POST' });
                const data = await response.json();
                if (data.status === 'stopped') {
                    isRunning = false;
                    updateStatusUI('stopped');
                }
            } catch (error) {
                console.error('ì¤‘ì§€ ì˜¤ë¥˜:', error);
            }
        }
        
        async function setMode(mode, btn) {
            currentMode = mode;
            document.querySelectorAll('.btn-mode').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            if (isRunning) {
                try {
                    await fetch('/api/mode', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ mode: mode })
                    });
                } catch (error) {
                    console.error('ëª¨ë“œ ë³€ê²½ ì˜¤ë¥˜:', error);
                }
            }
        }
        
        async function fetchData() {
            try {
                const [dataRes, historyRes, statsRes] = await Promise.all([
                    fetch('/api/data'),
                    fetch('/api/history'),
                    fetch('/api/statistics')
                ]);
                
                const data = await dataRes.json();
                const history = await historyRes.json();
                const stats = await statsRes.json();
                
                updateDisplay(data, history, stats);
            } catch (error) {
                console.error('ë°ì´í„° ì¡°íšŒ ì˜¤ë¥˜:', error);
            }
        }
        
        function updateStatusUI(status, isArc = false) {
            const statusDot = document.getElementById('statusDot');
            const statusRing = document.getElementById('statusRing');
            const statusText = document.getElementById('statusText');
            const alertBanner = document.getElementById('alertBanner');
            
            if (status === 'running') {
                if (isArc) {
                    statusDot.className = 'status-dot arc';
                    statusDot.textContent = 'âš ï¸';
                    statusRing.className = 'status-ring arc';
                    statusText.className = 'arc';
                    statusText.textContent = 'ì•„í¬ ê°ì§€!';
                    alertBanner.classList.add('show');
                } else {
                    statusDot.className = 'status-dot normal';
                    statusDot.textContent = 'âœ“';
                    statusRing.className = 'status-ring active';
                    statusText.className = 'normal';
                    statusText.textContent = 'ì •ìƒ ìš´ì „';
                    alertBanner.classList.remove('show');
                }
            } else {
                statusDot.className = 'status-dot stopped';
                statusDot.textContent = 'â¸ï¸';
                statusRing.className = 'status-ring';
                statusText.className = 'stopped';
                statusText.textContent = 'ëŒ€ê¸° ì¤‘';
                alertBanner.classList.remove('show');
            }
        }
        
        function updateDisplay(data, history, stats) {
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            if (data.status === 'running') {
                isRunning = true;
                updateStatusUI('running', data.is_arc);
            } else {
                updateStatusUI('stopped');
            }
            
            // ëª¨ë“œ í‘œì‹œ
            const modeNames = {
                'normal': 'ì •ìƒ ëª¨ë“œ',
                'arc_spike': 'ìŠ¤íŒŒì´í¬ ì•„í¬ ëª¨ë“œ',
                'arc_continuous': 'ì—°ì† ì•„í¬ ëª¨ë“œ',
                'arc_intermittent': 'ê°„í— ì•„í¬ ëª¨ë“œ',
                'random': 'ëœë¤ ëª¨ë“œ'
            };
            document.getElementById('modeText').textContent = modeNames[currentMode] || currentMode;
            
            // í™•ë¥  ì—…ë°ì´íŠ¸
            const prob = data.probability * 100;
            const probValue = document.getElementById('probabilityValue');
            const probFill = document.getElementById('probabilityFill');
            const gaugeFill = document.getElementById('gaugeFill');
            
            probValue.textContent = `${prob.toFixed(1)}%`;
            probFill.style.width = `${prob}%`;
            
            // ê²Œì´ì§€ ì—…ë°ì´íŠ¸
            const angle = (prob / 100) * 360;
            let color;
            if (prob < 30) {
                probValue.className = 'probability-value low';
                color = 'var(--success)';
                probFill.style.background = 'var(--success)';
            } else if (prob < 70) {
                probValue.className = 'probability-value medium';
                color = 'var(--warning)';
                probFill.style.background = 'var(--warning)';
            } else {
                probValue.className = 'probability-value high';
                color = 'var(--danger)';
                probFill.style.background = 'var(--danger)';
            }
            gaugeFill.style.background = `conic-gradient(${color} 0deg, ${color} ${angle}deg, transparent ${angle}deg)`;
            
            // íƒ€ì„ìŠ¤íƒ¬í”„
            document.getElementById('timestamp').textContent = data.timestamp || '-';
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            if (stats && Object.keys(stats).length > 0) {
                document.getElementById('totalWindows').textContent = stats.total_windows || 0;
                document.getElementById('arcCount').textContent = stats.arc_detected_count || 0;
                document.getElementById('arcRatio').textContent = `${((stats.arc_ratio || 0) * 100).toFixed(1)}%`;
                document.getElementById('avgProb').textContent = `${((stats.avg_probability || 0) * 100).toFixed(1)}%`;
            }
            
            // íŒŒí˜• ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            if (data.waveform && data.waveform.length > 0) {
                waveformChart.data.datasets[0].data = data.waveform;
                waveformChart.data.datasets[0].borderColor = data.is_arc ? '#ff4444' : '#00d4ff';
                waveformChart.data.datasets[0].backgroundColor = data.is_arc ? 'rgba(255, 68, 68, 0.1)' : 'rgba(0, 212, 255, 0.1)';
                waveformChart.update('none');
                
                // ì„¼ì„œ ê°’ ê³„ì‚°
                const waveform = data.waveform;
                const rms = Math.sqrt(waveform.reduce((a, b) => a + b * b, 0) / waveform.length);
                const peak = Math.max(...waveform.map(Math.abs));
                document.getElementById('rmsValue').textContent = rms.toFixed(1);
                document.getElementById('peakValue').textContent = peak.toFixed(1);
                document.getElementById('thdValue').textContent = data.is_arc ? '>5' : '<1';
            }
            
            // íˆìŠ¤í† ë¦¬ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            if (history && history.length > 0) {
                historyChart.data.labels = history.map(h => h.timestamp);
                historyChart.data.datasets[0].data = history.map(h => h.probability * 100);
                historyChart.update('none');
            }
        }
        
        // ì£¼ê¸°ì  ë°ì´í„° ê°±ì‹  (500ms)
        setInterval(fetchData, 500);
        
        // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        fetchData();
    </script>
</body>
</html>
